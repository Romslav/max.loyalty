# üìö Max Loyalty ‚Äî –ü–æ–ª–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

> **–í–µ—Ä—Å–∏—è:** 1.0.0 | **–û–±–Ω–æ–≤–ª–µ–Ω–æ:** –§–µ–≤—Ä–∞–ª—å 2026

---

## üó∫Ô∏è –°–µ—Å—Å–∏–∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏

–ö–∞–∂–¥–∞—è —Å–µ—Å—Å–∏—è (S-XX) ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–ª–æ–∫ —Å–∏—Å—Ç–µ–º—ã: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, –∫–æ–¥, —Å—Ö–µ–º—ã, UI/UX.

| –°–µ—Å—Å–∏—è | –°—Ç–∞—Ç—É—Å | –ë–ª–æ–∫ | –†–µ—à–µ–Ω–∏–π | –§–∞–π–ª |
|--------|--------|------|---------|------|
| S-00 | ‚úÖ | Setup ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏, –∫–æ–Ω—Ñ–∏–≥–∏ | ‚Äî | [S-00-setup.md](sessions/S-00-setup.md) |
| S-01 | ‚è≥ | Database Schema ‚Äî Prisma models, –∏–Ω–¥–µ–∫—Å—ã, –º–∏–≥—Ä–∞—Ü–∏–∏, RLS | 35 | [S-01-db-schema.md](sessions/S-01-db-schema.md) |
| S-02 | ‚è≥ | Backend API ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, —Å–µ—Ä–≤–∏—Å—ã, RBAC, guards | 30 | [S-02-backend-api.md](sessions/S-02-backend-api.md) |
| S-03 | ‚è≥ | POS Integration ‚Äî iiko C# WPF + R-Keeper C++ DLL | 36 | [S-03-pos-integration.md](sessions/S-03-pos-integration.md) |
| S-04 | ‚è≥ | Frontend Admin Panel ‚Äî UI/UX, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, —Å—Ç–µ–π—Ç | 31 | [S-04-frontend-admin.md](sessions/S-04-frontend-admin.md) |
| S-05 | ‚è≥ | Manager Dashboard ‚Äî –ø—Ä–∞–≤–∞, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –º–µ–Ω–µ–¥–∂–µ—Ä–∞ | 25 | [S-05-manager-dashboard.md](sessions/S-05-manager-dashboard.md) |
| S-06 | ‚è≥ | Cashier Interface ‚Äî PIN-auth, touch UI, POS —ç–∫—Ä–∞–Ω | 25 | [S-06-cashier-interface.md](sessions/S-06-cashier-interface.md) |
| S-07 | ‚è≥ | Telegram Mini App ‚Äî –±–æ—Ç + –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Å—Ç—è | 41 | [S-07-telegram-mini-app.md](sessions/S-07-telegram-mini-app.md) |
| S-08 | ‚è≥ | Notifications ‚Äî Telegram/Email/SMS, BullMQ, —à–∞–±–ª–æ–Ω—ã | 36 | [S-08-notifications.md](sessions/S-08-notifications.md) |
| S-09 | ‚è≥ | Analytics & Reporting ‚Äî Owner/Admin/Manager –æ—Ç—á—ë—Ç—ã | 21 | [S-09-analytics.md](sessions/S-09-analytics.md) |
| S-10 | ‚è≥ | Billing & Subscriptions ‚Äî —Ç–∞—Ä–∏—Ñ—ã, YooKassa, Stripe | 23 | [S-10-billing.md](sessions/S-10-billing.md) |
| S-11 | ‚è≥ | Testing Strategy ‚Äî Unit/Integration/E2E/Load | 40 | [S-11-testing.md](sessions/S-11-testing.md) |
| S-12 | ‚è≥ | Infrastructure & DevOps ‚Äî Fly.io, Docker, CI/CD | 47 | [S-12-infrastructure.md](sessions/S-12-infrastructure.md) |
| S-13 | ‚è≥ | Owner Platform Dashboard ‚Äî MRR/ARR/Churn/Impersonation | 35 | [S-13-owner-dashboard.md](sessions/S-13-owner-dashboard.md) |
| S-14 | ‚è≥ | API Documentation & Webhooks ‚Äî OpenAPI, Swagger | 30 | [S-14-api-docs.md](sessions/S-14-api-docs.md) |

**–ò—Ç–æ–≥–æ —Ä–µ—à–µ–Ω–∏–π: ~450 | –°—Ç–∞—Ç—É—Å: ‚úÖ = –≥–æ—Ç–æ–≤–æ, üîÑ = –≤ —Ä–∞–±–æ—Ç–µ, ‚è≥ = –æ–∂–∏–¥–∞–µ—Ç**

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

| –î–æ–∫—É–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| [OVERVIEW.md](architecture/OVERVIEW.md) | –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –ø—Ä–∏–Ω—Ü–∏–ø—ã, –ø–æ–ª–Ω—ã–π tech-stack |
| [AUTH-FLOW.md](architecture/AUTH-FLOW.md) | Auth flow ‚Äî JWT, refresh, RBAC, permissions |
| [MULTI-TENANCY.md](architecture/MULTI-TENANCY.md) | Multi-tenant —Ä–µ—à–µ–Ω–∏—è ‚Äî RLS, Prisma middleware |
| [LOYALTY-ENGINE.md](architecture/LOYALTY-ENGINE.md) | –î–≤–∏–∂–æ–∫ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ ‚Äî –ø—Ä–∞–≤–∏–ª–∞, —É—Ä–æ–≤–Ω–∏, –±–∞–ª–ª—ã |
| [BILLING.md](architecture/BILLING.md) | –ë–∏–ª–ª–∏–Ω–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ ‚Äî —Ç–∞—Ä–∏—Ñ—ã, –ø–ª–∞—Ç–µ–∂–∏, –≤–µ–±—Ö—É–∫–∏ |
| [SECURITY.md](architecture/SECURITY.md) | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Äî 51 –∫–æ–Ω—Ç—Ä–æ–ª—å, GDPR, -152, PCI DSS |
| [UI-DESIGN-SYSTEM.md](architecture/UI-DESIGN-SYSTEM.md) | –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞ ‚Äî —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, —Ç–æ–∫–µ–Ω—ã |

---

## üìê –§–∏–Ω–∞–ª—å–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –ú–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- **npm workspaces** ‚Äî `apps/*` + `packages/*`, –µ–¥–∏–Ω—ã–π lock-—Ñ–∞–π–ª
- **Backend** ‚Äî NestJS Modular Monolith (–Ω–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –Ω–∞ MVP)
- **Frontend** ‚Äî Next.js 14 App Router, —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **PostgreSQL** (Neon.tech) ‚Äî single shared DB, `tenantId` –Ω–∞ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ
- **UUID** ‚Äî –ø–µ—Ä–≤–∏—á–Ω—ã–µ –∫–ª—é—á–∏ (–Ω–µ auto-increment), –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ multi-tenant
- **Soft delete** ‚Äî `deletedAt DateTime?` –Ω–∞ User, GuestCard, Restaurant
- **Immutable history** ‚Äî BallTransaction –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è (hard, —Ç–æ–ª—å–∫–æ audit)
- **JSONB** ‚Äî `ruleSnapshot`, `promoConditions`, `rewardConfig`, `posRawPayload`
- **Decimal** ‚Äî –¥–ª—è –¥–µ–Ω–µ–≥ `DECIMAL(10,2)`, Integer –¥–ª—è –±–∞–ª–ª–æ–≤
- **Prisma middleware** (Layer 1) + **PostgreSQL RLS** (Layer 2) ‚Äî –¥–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞ tenant-–∏–∑–æ–ª—è—Ü–∏–∏

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è & –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- **Access token** ‚Äî JWT, 15 –º–∏–Ω, `Authorization: Bearer` header
- **Refresh token** ‚Äî JWT, 30 –¥–Ω–µ–π, `HttpOnly Secure Cookie`
- **RBAC** ‚Äî —Ä–æ–ª—å (–±–∞–∑–æ–≤—ã–µ –ø—Ä–∞–≤–∞) + –º–µ–ª–∫–æ–∑–µ—Ä–Ω–∏—Å—Ç—ã–µ permissions –æ—Ç Admin
- **Rate limiting** ‚Äî 5 –ø–æ–ø—ã—Ç–æ–∫ / 15 –º–∏–Ω / IP (Redis)
- **Dual-secret JWT** ‚Äî –≥–æ—Ä—è—á–∞—è —Ä–æ—Ç–∞—Ü–∏—è –±–µ–∑ downtime

### –°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
- **1 –±–∞–ª–ª = 1 ‚ÇΩ** –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏ (–±–∞–∑–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ)
- **UNIFIED** ‚Äî –æ–¥–Ω–∞ –∫–∞—Ä—Ç–∞ –Ω–∞ –≤—Å—é —Å–µ—Ç—å —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
- **SEPARATE** ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–∞—Ä—Ç—ã –Ω–∞ –∫–∞–∂–¥—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω
- **–£—Ä–æ–≤–Ω–∏** ‚Äî Bronze (0‚ÇΩ) ‚Üí Silver (150K‚ÇΩ) ‚Üí Gold (400K‚ÇΩ) ‚Üí Platinum (1M‚ÇΩ)
- **One-way up** ‚Äî –ø–æ–Ω–∏–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ
- **Lifetime Spent** ‚Äî –ø–æ—Ä–æ–≥–∏ —É—Ä–æ–≤–Ω–µ–π –ø–æ —Å—É–º–º–µ –≤—Å–µ—Ö –ø–æ–∫—É–ø–æ–∫ –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è

### –¢–∞—Ä–∏—Ñ—ã –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- **6 —Ç–∞—Ä–∏—Ñ–æ–≤**: Free (internal Owner), Standard, Medium, Pro, Ultimate, Custom
- **–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞**: –º–µ—Å—è—Ü –∏–ª–∏ –≥–æ–¥ (—Å–∫–∏–¥–∫–∞ 20% –∑–∞ –≥–æ–¥)
- **–õ–∏–º–∏—Ç—ã**: `max_restaurants`, `max_guests` ‚Äî –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º** –ø—Ä–∏ –Ω–µ–æ–ø–ª–∞—Ç–µ: –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã

### POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- **iiko Front** ‚Äî C# WPF –ø–ª–∞–≥–∏–Ω, –∫–Ω–æ–ø–∫–∞ ¬´–ú–ê–ö–°–ò–ú–£–ú¬ª –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–î–û–ü–û–õ–ù–ï–ù–ò–Ø¬ª
- **R-Keeper** ‚Äî C++ DLL, Floating Button 60√ó60px –ø–æ–≤–µ—Ä—Ö –∫–∞—Å—Å–æ–≤–æ–≥–æ –æ–∫–Ω–∞, C# WPF UI
- **Webhook HMAC-SHA256** ‚Äî –ø–æ–¥–ø–∏—Å—å + timestamp (replay protection 5 –º–∏–Ω)
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** ‚Äî Redis + DB UNIQUE constraint –Ω–∞ `posCheckId + tenantId`
- **Forward-only** ‚Äî –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è; —Ä—É—á–Ω–æ–π CSV-–∏–º–ø–æ—Ä—Ç –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

### Infrastructure (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π MVP)
- **Backend** ‚Äî Fly.io: 3 VM (API + Worker + Cron), `fra` Frankfurt, 256MB RAM –∫–∞–∂–¥–∞—è
- **DB** ‚Äî Neon.tech PostgreSQL 3GB, `eu-central-1`
- **Redis** ‚Äî Upstash 10K –∫–æ–º–∞–Ω–¥/–¥–µ–Ω—å
- **Storage** ‚Äî Cloudflare R2 10GB, unlimited bandwidth
- **Email** ‚Äî Resend 3K/–º–µ—Å—è—Ü
- **SMS** ‚Äî SMS.RU ~1‚ÇΩ/SMS
- **CI/CD** ‚Äî GitHub Actions 2K –º–∏–Ω/–º–µ—Å—è—Ü
- **Monitoring** ‚Äî Better Stack (1GB logs + uptime)

---

## üî¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –í—Å–µ–≥–æ —Ä–µ—à–µ–Ω–∏–π –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ | ~450 |
| –ë–ª–æ–∫–æ–≤ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ | 14 |
| –¢–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö | ~42 |
| API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (–ø–ª–∞–Ω) | 80+ |
| –ö–æ–Ω—Ç—Ä–æ–ª–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ | 51 |
| GitHub Actions workflows | 5 |
| –°–µ—Ä–≤–∏—Å–æ–≤ –≤ docker-compose.dev | 5 (PostgreSQL, Redis, MinIO, Mailhog) |
| –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö POS-—Å–∏—Å—Ç–µ–º | 2 (iiko + R-Keeper) |
| –ö–∞–Ω–∞–ª–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π | 3 (Telegram, Email, SMS) |

---

## üöÄ –ü–æ—Ä—è–¥–æ–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

```
Phase 1 ‚Äî Core (MVP)
‚îú‚îÄ‚îÄ S-01: Database Schema + Migrations
‚îú‚îÄ‚îÄ S-02: Backend API (Auth + Users + Tenants + Loyalty Engine)
‚îú‚îÄ‚îÄ S-10: Billing (YooKassa + Subscriptions)
‚îî‚îÄ‚îÄ S-12: Infrastructure (Fly.io + CI/CD + Secrets)

Phase 2 ‚Äî Admin & Analytics
‚îú‚îÄ‚îÄ S-04: Frontend Admin Panel
‚îú‚îÄ‚îÄ S-09: Analytics (Owner + Admin)
‚îî‚îÄ‚îÄ S-13: Owner Dashboard (MRR/ARR/Churn)

Phase 3 ‚Äî POS & Guest
‚îú‚îÄ‚îÄ S-03: POS Integration (iiko ‚Üí R-Keeper)
‚îú‚îÄ‚îÄ S-07: Telegram Mini App
‚îî‚îÄ‚îÄ S-08: Notifications (Telegram/Email/SMS)

Phase 4 ‚Äî Extended
‚îú‚îÄ‚îÄ S-05: Manager Dashboard
‚îú‚îÄ‚îÄ S-06: Cashier Interface
‚îî‚îÄ‚îÄ S-14: API Docs & Webhooks (–ø—É–±–ª–∏—á–Ω—ã–π API)

Phase 5 ‚Äî Quality & Scale
‚îú‚îÄ‚îÄ S-11: Testing Strategy (Unit/E2E/Load)
‚îî‚îÄ‚îÄ Security Hardening (51 controls)
```

---

*üìå –î–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π —Å—Å—ã–ª–∫–∏ –≤—ã—à–µ. –ö–∞–∂–¥–∞—è —Å–µ—Å—Å–∏—è —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞.*
