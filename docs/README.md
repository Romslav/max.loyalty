# üìö Max Loyalty ‚Äî –ü–æ–ª–Ω–∞—è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ü—Ä–æ–µ–∫—Ç–∞

> **Max Loyalty** ‚Äî –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è (multi-tenant) SaaS-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–µ—Ç–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤.  
> –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã —Å–∏—Å—Ç–µ–º—ã: –æ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –¥–æ –∫–æ–¥–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

```
docs/
‚îú‚îÄ‚îÄ README.md                          ‚Üê –í—ã –∑–¥–µ—Å—å: –Ω–∞–≤–∏–≥–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ 00_SYSTEM_OVERVIEW.md             ‚Üê –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
‚îÇ
‚îú‚îÄ‚îÄ blocks/
‚îÇ   ‚îú‚îÄ‚îÄ 01_DATABASE_SCHEMA.md         ‚Üê Prisma-—Å—Ö–µ–º–∞, –º–æ–¥–µ–ª–∏, –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ 02_BACKEND_API.md             ‚Üê NestJS API, –º–æ–¥—É–ª–∏, —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ 03_POS_INTEGRATION.md         ‚Üê iiko, R-Keeper, Webhook/PULL
‚îÇ   ‚îú‚îÄ‚îÄ 04_FRONTEND_ADMIN.md          ‚Üê Next.js 14, shadcn/ui, stack
‚îÇ   ‚îú‚îÄ‚îÄ 05_OWNER_DASHBOARD.md         ‚Üê –î–∞—à–±–æ—Ä–¥ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (Owner)
‚îÇ   ‚îú‚îÄ‚îÄ 06_MANAGER_DASHBOARD.md       ‚Üê –î–∞—à–±–æ—Ä–¥ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ (Manager)
‚îÇ   ‚îú‚îÄ‚îÄ 07_CASHIER_POS.md             ‚Üê –ö–∞—Å—Å–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Cashier)
‚îÇ   ‚îú‚îÄ‚îÄ 08_TELEGRAM_MINI_APP.md       ‚Üê Telegram Bot + Mini App
‚îÇ   ‚îú‚îÄ‚îÄ 09_NOTIFICATIONS.md           ‚Üê –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (BullMQ, 4 –∫–∞–Ω–∞–ª–∞)
‚îÇ   ‚îú‚îÄ‚îÄ 10_LOYALTY_ENGINE.md          ‚Üê –î–≤–∏–∂–æ–∫ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ 11_ANALYTICS.md               ‚Üê –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á—ë—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ 12_BILLING.md                 ‚Üê –ë–∏–ª–ª–∏–Ω–≥ –∏ –ø–æ–¥–ø–∏—Å–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ 13_TESTING_STRATEGY.md        ‚Üê –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ 14_INFRASTRUCTURE_DEVOPS.md   ‚Üê DevOps, CI/CD, –¥–µ–ø–ª–æ–π
‚îÇ   ‚îú‚îÄ‚îÄ 15_SECURITY_COMPLIANCE.md     ‚Üê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (51 –∫–æ–Ω—Ç—Ä–æ–ª—å)
‚îÇ   ‚îú‚îÄ‚îÄ 16_API_DOCUMENTATION.md       ‚Üê OpenAPI, Webhooks, SDK
‚îÇ   ‚îú‚îÄ‚îÄ 17_IIKO_PLUGIN.md             ‚Üê –ü–ª–∞–≥–∏–Ω iiko Front (.NET/WPF)
‚îÇ   ‚îî‚îÄ‚îÄ 18_RKEEPER_PLUGIN.md          ‚Üê –ü–ª–∞–≥–∏–Ω R-Keeper (C++/WPF)
‚îÇ
‚îú‚îÄ‚îÄ 19_DEVELOPMENT_ROADMAP.md         ‚Üê –ü—É—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (32 –Ω–µ–¥–µ–ª–∏)
‚îú‚îÄ‚îÄ 20_PROJECT_STRUCTURE.md           ‚Üê –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ 21_PROJECT_ARCHITECTURE.md        ‚Üê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (C4, ER, Sequence)
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

| –ï—Å–ª–∏ –≤—ã... | –ß–∏—Ç–∞–π—Ç–µ... |
|---|---|
| –•–æ—Ç–∏—Ç–µ –ø–æ–Ω—è—Ç—å —Å–∏—Å—Ç–µ–º—É —Ü–µ–ª–∏–∫–æ–º | [`00_SYSTEM_OVERVIEW.md`](./00_SYSTEM_OVERVIEW.md) |
| –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö | [`blocks/01_DATABASE_SCHEMA.md`](./blocks/01_DATABASE_SCHEMA.md) |
| –†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ backend API | [`blocks/02_BACKEND_API.md`](./blocks/02_BACKEND_API.md) |
| –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç–µ POS-—Å–∏—Å—Ç–µ–º—É | [`blocks/03_POS_INTEGRATION.md`](./blocks/03_POS_INTEGRATION.md) |
| –°—Ç—Ä–æ–∏—Ç–µ frontend | [`blocks/04_FRONTEND_ADMIN.md`](./blocks/04_FRONTEND_ADMIN.md) |
| –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ Telegram –±–æ—Ç–∞ | [`blocks/08_TELEGRAM_MINI_APP.md`](./blocks/08_TELEGRAM_MINI_APP.md) |
| –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É | [`blocks/14_INFRASTRUCTURE_DEVOPS.md`](./blocks/14_INFRASTRUCTURE_DEVOPS.md) |
| –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç–µ iiko-–ø–ª–∞–≥–∏–Ω | [`blocks/17_IIKO_PLUGIN.md`](./blocks/17_IIKO_PLUGIN.md) |
| –ü–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É | [`19_DEVELOPMENT_ROADMAP.md`](./19_DEVELOPMENT_ROADMAP.md) |

---

## üìÑ –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### üåê –§–∞–π–ª 1: `00_SYSTEM_OVERVIEW.md` ‚Äî –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
–ö–æ–Ω—Ü–µ–ø—Ü–∏—è Max Loyalty –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞. –í—Å–µ —Ä–æ–ª–∏ (Owner ‚Üí Admin ‚Üí Manager ‚Üí Cashier ‚Üí Guest),  
–≤—Å–µ 6 —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—É—Ç–∏, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º –∫–∞–∂–¥–æ–≥–æ –≤—ã–±–æ—Ä–∞,  
–≥–ª–æ—Å—Å–∞—Ä–∏–π —Ç–µ—Ä–º–∏–Ω–æ–≤, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, FAQ.

---

### üóÑÔ∏è –§–∞–π–ª 2: `blocks/01_DATABASE_SCHEMA.md` ‚Äî Database Schema
–ü–æ–ª–Ω–∞—è Prisma-—Å—Ö–µ–º–∞ –≤—Å–µ—Ö 35+ –º–æ–¥–µ–ª–µ–π. Multi-tenancy (pooled, `tenantId` –≤ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ),  
–≤—Å–µ —Å–≤—è–∑–∏, –∏–Ω–¥–µ–∫—Å—ã, constraints, enums, —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –º–∏–≥—Ä–∞—Ü–∏–π, seed-–¥–∞–Ω–Ω—ã–µ, –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤.

**–ö–ª—é—á–µ–≤—ã–µ –º–æ–¥–µ–ª–∏:** `User`, `GuestProfile`, `GuestCard`, `BallTransaction`, `LoyaltyRule`,  
`LoyaltyRuleVersion`, `PromoRule`, `POSTransaction`, `Subscription`, `Payment`, `Notification`

---

### üîß –§–∞–π–ª 3: `blocks/02_BACKEND_API.md` ‚Äî Backend API (NestJS)
–ú–æ–¥—É–ª—å–Ω—ã–π –º–æ–Ω–æ–ª–∏—Ç –Ω–∞ NestJS. 80+ API-—ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤, –ø–æ–ª–Ω—ã–π –∫–æ–¥ Guards, Decorators, DTOs,  
Services. Loyalty Engine API (calculate, earn, redeem), Loyalty Builder (rules/levels/promos),  
Background Jobs (BullMQ), Analytics API (4 —É—Ä–æ–≤–Ω—è), Notifications API, Error Handling (RFC 7807).

---

### üè™ –§–∞–π–ª 4: `blocks/03_POS_INTEGRATION.md` ‚Äî POS Integration
–ì–∏–±—Ä–∏–¥–Ω–∞—è PUSH/PULL –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –∫–∞—Å—Å–æ–≤—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (iiko, R-Keeper, AirKeeper).  
Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å HMAC-SHA256, BullMQ-–æ—á–µ—Ä–µ–¥—å, idempotency, reconciliation,  
Adaptor pattern (`IPOSAdapter`), feature-–º–∞—Ç—Ä–∏—Ü–∞ —Å–∏—Å—Ç–µ–º, Offline/CSV fallback.

---

### üñ•Ô∏è –§–∞–π–ª 5: `blocks/04_FRONTEND_ADMIN.md` ‚Äî Frontend Admin Panel
Next.js 14 App Router + shadcn/ui + Tailwind CSS + TanStack Query + Zustand.  
Dark design system (CSS variables), Server-Sent Events –¥–ª—è real-time,  
Layout (Sidebar/Header/Breadcrumbs), –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ —Ä–æ–ª—è–º.

---

### üìä –§–∞–π–ª 6: `blocks/05_OWNER_DASHBOARD.md` ‚Äî Owner Platform Dashboard
35 –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤. KPI (MRR, Churn, Active Tenants), Tenant Table —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏,  
Impersonation Flow, Tenant Details Modal (5 –≤–∫–ª–∞–¥–æ–∫), Health Score –∞–ª–≥–æ—Ä–∏—Ç–º,  
Cohort Analysis, Predicted Churn, Real-time SSE, Mobile-responsive.

---

### üçΩÔ∏è –§–∞–π–ª 7: `blocks/06_MANAGER_DASHBOARD.md` ‚Äî Manager Dashboard
–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ–¥–Ω–æ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞: Revenue, Avg Check, RFM-—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Å—Ç–µ–π,  
—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ—è–ª—å–Ω–æ—Å—Ç—å—é –≤ —Ä–∞–º–∫–∞—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π, –æ—Ç—á—ë—Ç—ã –∏ —ç–∫—Å–ø–æ—Ä—Ç (CSV/Excel).

---

### üñ®Ô∏è –§–∞–π–ª 8: `blocks/07_CASHIER_POS.md` ‚Äî Cashier POS Interface
–û—Ç–¥–µ–ª—å–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `pos.maxloyalty.app`. PIN-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (NumPad UI),  
Touch-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (debounce 200ms, barcode scanner), Earn/Redeem –º–æ–¥–∞–ª—ã,  
Offline-—Ä–µ–∂–∏–º (IndexedDB), —Ç–µ–ø–ª–æ–≤–∞—è –ø–µ—á–∞—Ç—å, –∑–∞—â–∏—Ç–∞ –æ—Ç –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞.

---

### üì± –§–∞–π–ª 9: `blocks/08_TELEGRAM_MINI_APP.md` ‚Äî Telegram Mini App
41 –¥–µ—Ç–∞–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å –∏ –æ—Ç–≤–µ—Ç. Telegraf-–±–æ—Ç, UNIFIED/SEPARATE —Ä–µ–∂–∏–º—ã, –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –≥–æ—Å—Ç—è,  
Mini App auth (HMAC-SHA256 ‚Üí JWT), –¥–∏–∑–∞–π–Ω –∫–∞—Ä—Ç—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (QR 280px, —Ü–≤–µ—Ç–∞ —É—Ä–æ–≤–Ω–µ–π),  
—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, edge-cases (–±–æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞).

---

### üîî –§–∞–π–ª 10: `blocks/09_NOTIFICATIONS.md` ‚Äî Notifications System
16 —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, 4 –∫–∞–Ω–∞–ª–∞ (Telegram/Email/SMS/Push), BullMQ-–æ—á–µ—Ä–µ–¥–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏,  
HTML-—à–∞–±–ª–æ–Ω—ã email, SMS-–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (SMSC.ru), opt-in/opt-out —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Å—Ç–µ–º,  
history —Å retry –∏ Dead Letter Queue.

---

### üéØ –§–∞–π–ª 11: `blocks/10_LOYALTY_ENGINE.md` ‚Äî Loyalty Engine
–ü–æ–ª–Ω—ã–π –¥–≤–∏–∂–æ–∫ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏: POINTS/DISCOUNT —Ç–∏–ø—ã, UNIFIED/SEPARATE —Ä–µ–∂–∏–º—ã,  
–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª (`LoyaltyRuleVersion`), —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –ø—Ä–æ–º–æ  
(COMBINE_ALL/MAX_ONLY/FIRST_ONLY), FIFO-—ç–∫—Å–ø–∏—Ä–∞—Ü–∏—è –±–∞–ª–ª–æ–≤, —É—Ä–æ–≤–Ω–∏ –≥–æ—Å—Ç–µ–π (Bronze/Silver/Gold),  
–º–∏–≥—Ä–∞—Ü–∏–∏ UNIFIED‚ÜîSEPARATE, reconciliation, Redis-–∫—ç—à.

---

### üìà –§–∞–π–ª 12: `blocks/11_ANALYTICS.md` ‚Äî Analytics & Reports
4 —É—Ä–æ–≤–Ω—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: Platform (Owner) / Restaurant (Admin) / My Restaurant (Manager) / Personal (Guest).  
`AnalyticsDailySnapshot`, CRON pre-calculation, RFM-—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è,  
Cohort Analysis, Retention curves, —ç–∫—Å–ø–æ—Ä—Ç CSV/Excel.

---

### üí≥ –§–∞–π–ª 13: `blocks/12_BILLING.md` ‚Äî Billing & Subscriptions
6 —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ (FREE/STANDARD/MEDIUM/PRO/ULTIMATE/CUSTOM), Trial, grace period 90 –¥–Ω–µ–π,  
YooKassa + Stripe + CloudPayments + CryptoCloud, refund/chargeback,  
manual invoice, limit enforcement, upgrade/downgrade flow.

---

### üß™ –§–∞–π–ª 14: `blocks/13_TESTING_STRATEGY.md` ‚Äî Testing Strategy
–ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–æ–≤: 10 Unit + 10 Integration + 10 E2E + 5 Contract + 10 Load + 10 Security = 55 —Ç–µ—Å—Ç–æ–≤.  
Jest, Supertest, k6, Artillery. GitHub Actions CI/CD –º–∞—Ç—Ä–∏—Ü–∞.

---

### üèóÔ∏è –§–∞–π–ª 15: `blocks/14_INFRASTRUCTURE_DEVOPS.md` ‚Äî Infrastructure & DevOps
Fly.io (backend) + Vercel (frontend) + Neon.tech (PostgreSQL) + Upstash (Redis).  
Multi-stage Dockerfile, `PROCESS_TYPE` (api/worker/cron), GitHub Actions CI/CD,  
Prometheus + Grafana + Sentry + ELK, graceful shutdown, secrets management.

---

### üîí –§–∞–π–ª 16: `blocks/15_SECURITY_COMPLIANCE.md` ‚Äî Security & Compliance
51 –∫–æ–Ω—Ç—Ä–æ–ª—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. JWT RS256, AES-256-GCM (PII), TLS 1.3, bcrypt(cost=12),  
GDPR (right-to-erasure, consent), PCI DSS, P1-P4 SLA, Incident Response Playbooks,  
Daily Snyk scan, penetration testing, $52,000 security budget Year 1.

---

### üìñ –§–∞–π–ª 17: `blocks/16_API_DOCUMENTATION.md` ‚Äî API Documentation
OpenAPI 3.0 + GitBook. 20 webhook-—Å–æ–±—ã—Ç–∏–π, HMAC-–ø–æ–¥–ø–∏—Å—å, exponential backoff retry,  
TypeScript SDK (auto-gen —á–µ—Ä–µ–∑ GitHub Actions), Postman Workspace,  
changelog automation, Sandbox (staging keys `mlk_test_...`), community `@maxloyaltydev`.

---

### üîå –§–∞–π–ª 18: `blocks/17_IIKO_PLUGIN.md` ‚Äî iiko Front Plugin (.NET/WPF)
C# .NET 4.7.2 –ø–ª–∞–≥–∏–Ω –¥–ª—è iiko Front. `IFrontPlugin` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –ø–æ–ª–Ω—ã–π lifecycle –∑–∞–∫–∞–∑–∞,  
LoyaltyApiClient (Polly retry), OfflineQueueService (JSON —Ñ–∞–π–ª, max 100 ops, TTL 24—á),  
WPF-–æ–∫–Ω–∞ (Search/Operation/Diagnostics), API Key —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ AES-256, auto-update.

---

### üîå –§–∞–π–ª 19: `blocks/18_RKEEPER_PLUGIN.md` ‚Äî R-Keeper Plugin (C++/WPF)
–î–≤–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: `MaxLoyaltyRKeeper.dll` (C++ Native, External DLL) + `MaxLoyaltyRKeeperUI.exe` (C# WPF).  
Shared Memory (Memory-Mapped File, 1 MB JSON), FarCard protocol,  
Installer Wizard (7 —à–∞–≥–æ–≤: –∞–≤—Ç–æ–æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ R-Keeper, FarCard –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è), PBKDF2 API Key.

---

### üóìÔ∏è –§–∞–π–ª 20: `19_DEVELOPMENT_ROADMAP.md` ‚Äî Development Roadmap
–ü—É—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç –Ω—É–ª—è –¥–æ production –∑–∞ 32 –Ω–µ–¥–µ–ª–∏ (8 —Ñ–∞–∑).  
–î–µ—Ç–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø–æ –∫–∞–∂–¥–æ–π –Ω–µ–¥–µ–ª–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ GitHub Issues,  
Definition of Done –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞, —Ä–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏–∏.

---

### üìÅ –§–∞–π–ª 21: `20_PROJECT_STRUCTURE.md` ‚Äî Project Structure
–ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Monorepo (Turborepo/pnpm workspaces).  
–ö–∞–∂–¥–∞—è –ø–∞–ø–∫–∞ –∏ —Ñ–∞–π–ª —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º: `apps/backend/`, `apps/frontend/`, `apps/cashier/`,  
`apps/telegram-mini-app/`, `apps/iiko-plugin/`, `apps/rkeeper-plugin/`, `packages/`, `libs/`.

---

### üèõÔ∏è –§–∞–π–ª 22: `21_PROJECT_ARCHITECTURE.md` ‚Äî Project Architecture
C4 Model (Context/Container/Component), ER-–¥–∏–∞–≥—Ä–∞–º–º–∞ (Mermaid),  
Sequence –¥–∏–∞–≥—Ä–∞–º–º—ã (Earn Balls, Webhook, Auth, Telegram onboarding),  
Deployment –¥–∏–∞–≥—Ä–∞–º–º–∞, Data Flow, Security boundaries.

---

## üîë –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –°–ª–æ–π | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ |
|---|---|
| **Backend** | NestJS 10 + TypeScript + Prisma 5 + PostgreSQL 15 |
| **Queue/Cache** | BullMQ + Redis 7 + Upstash |
| **Frontend** | Next.js 14 + shadcn/ui + Tailwind CSS + TanStack Query + Zustand |
| **Telegram** | Telegraf + Telegram Mini App (React) |
| **POS Plugins** | C# .NET 4.7.2 WPF (iiko) + C++ Native DLL + C# WPF (R-Keeper) |
| **Payments** | YooKassa + Stripe + CloudPayments + CryptoCloud |
| **Hosting** | Fly.io + Vercel + Neon.tech (PostgreSQL) + Upstash (Redis) |
| **CI/CD** | GitHub Actions + Docker multi-stage |
| **Monitoring** | Prometheus + Grafana + Sentry + ELK Stack + BetterStack |

---

## üë• –†–æ–ª–∏ —Å–∏—Å—Ç–µ–º—ã

```
Owner
‚îú‚îÄ‚îÄ –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π —Ü–µ–ª–∏–∫–æ–º (—Ç–µ–Ω–∞–Ω—Ç—ã, –±–∏–ª–ª–∏–Ω–≥, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã)
‚îú‚îÄ‚îÄ –ú–æ–∂–µ—Ç –∏–º–øersonate –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
‚îÇ
Restaurant Admin
‚îú‚îÄ‚îÄ –£–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–º
‚îú‚îÄ‚îÄ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç loyalty rules, levels, promos
‚îú‚îÄ‚îÄ –í–∏–¥–∏—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É —Å–≤–æ–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
‚îÇ
Manager
‚îú‚îÄ‚îÄ –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–º
‚îú‚îÄ‚îÄ –ú–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å manual adjustment –±–∞–ª–ª–æ–≤ (—Å –ø—Ä–∏—á–∏–Ω–æ–π)
‚îú‚îÄ‚îÄ –í–∏–¥–∏—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É —Å–≤–æ–µ–≥–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ (–±–µ–∑ billing)
‚îÇ
Cashier
‚îú‚îÄ‚îÄ –†–∞–±–æ—Ç–∞–µ—Ç —Å –∫–∞—Å—Å–æ–≤—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º (pos.maxloyalty.app)
‚îú‚îÄ‚îÄ Earn/Redeem –±–∞–ª–ª—ã –¥–ª—è –≥–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã—Ö –≥–æ—Å—Ç–µ–π
‚îÇ
Guest
‚îî‚îÄ‚îÄ –ü–æ–ª—å–∑—É–µ—Ç—Å—è Telegram Mini App
    ‚îî‚îÄ‚îÄ –í–∏–¥–∏—Ç –±–∞–ª–∞–Ω—Å, –∏—Å—Ç–æ—Ä–∏—é, QR-–∫–æ–¥ –∫–∞—Ä—Ç—ã
```

---

## üìä –°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

| # | –î–æ–∫—É–º–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –°–µ—Å—Å–∏–π |
|---|---|---|---|
| 00 | System Overview | üîÑ –í —Ä–∞–±–æ—Ç–µ | 9 |
| 01 | Database Schema | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 7 |
| 02 | Backend API | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 8 |
| 03 | POS Integration | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 7 |
| 04 | Frontend Admin | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 7 |
| 05 | Owner Dashboard | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 7 |
| 06 | Manager Dashboard | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 6 |
| 07 | Cashier POS | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 7 |
| 08 | Telegram Mini App | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 7 |
| 09 | Notifications | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 6 |
| 10 | Loyalty Engine | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 7 |
| 11 | Analytics | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 6 |
| 12 | Billing | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 6 |
| 13 | Testing Strategy | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 6 |
| 14 | Infrastructure DevOps | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 7 |
| 15 | Security Compliance | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 7 |
| 16 | API Documentation | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 7 |
| 17 | iiko Plugin | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 6 |
| 18 | R-Keeper Plugin | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 6 |
| 19 | Development Roadmap | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 8 |
| 20 | Project Structure | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 7 |
| 21 | Project Architecture | ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ | 7 |

**–õ–µ–≥–µ–Ω–¥–∞:** ‚úÖ –ó–∞–≤–µ—Ä—à—ë–Ω ¬∑ üîÑ –í —Ä–∞–±–æ—Ç–µ ¬∑ ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** [github.com/Romslav/max.loyalty](https://github.com/Romslav/max.loyalty)
- **–°–µ—Å—Å–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** –°-001 ‚Üí –°-152
- **–§–æ—Ä–º–∞—Ç –±–µ—Å–µ–¥—ã:** 14 –±–µ—Å–µ–¥ + 2 —Ñ–∞–π–ª–∞ –ø–ª–∞–≥–∏–Ω–æ–≤ = ~914 –≤–æ–ø—Ä–æ—Å–æ–≤/—Ä–µ—à–µ–Ω–∏–π

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ 14 –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –±–µ—Å–µ–¥ –∏ –æ–ø–∏—Å–∞–Ω–∏–π –ø–ª–∞–≥–∏–Ω–æ–≤ iiko/R-Keeper.*  
*–ö–∞–∂–¥—ã–π —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∏–Ω–∏–º—É–º 400KB –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–¥–∞.*
